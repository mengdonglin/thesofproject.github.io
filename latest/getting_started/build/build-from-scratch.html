

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Build From Scratch &mdash; SOF Project 0.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/sof-favicon-16x16.png"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/sof-custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="SOF Project 0.1 documentation" href="../../index.html"/>
        <link rel="up" title="Getting Started Guide" href="../index.html"/>
        <link rel="next" title="Set up SOF on Minnowboard Turbot" href="../setup/setup_minnowboard_turbot.html"/>
        <link rel="prev" title="Build Sound Open Firmware from a Docker Container" href="build-docker.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> SOF Project
          

          
            
            <img src="../../_static/logo_sof_white_200w.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction to the SOF Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#components">Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#sof-architecture">SOF Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#sof-driver-architecture">SOF Driver Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#faq">FAQ</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Getting Started Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../build-guide/build-from-scratch.html">Build from scratch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../build-guide/build-from-scratch.html#build-sof-binaries">Build SOF binaries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../build-guide/build-from-scratch.html#set-up-build-environment">Set up build environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build-guide/build-from-scratch.html#build-toolchain-from-source">Build toolchain from source</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build-guide/build-from-scratch.html#build-firmware-binaries">Build firmware binaries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build-guide/build-from-scratch.html#build-topology-and-tools">Build topology and tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../build-guide/build-from-scratch.html#build-linux-kernel">Build Linux kernel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../build-guide/build-with-docker.html">Build with docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../build-guide/build-with-docker.html#set-up-docker">Set up Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../build-guide/build-with-docker.html#get-docker">Get Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build-guide/build-with-docker.html#set-proxy">Set Proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build-guide/build-with-docker.html#set-usergroup">Set usergroup</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build-guide/build-with-docker.html#get-docker-image">Get Docker image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../build-guide/build-with-docker.html#id2">Build with Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../build-guide/build-with-docker.html#build-firmware-binaries">Build firmware binaries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../build-guide/build-with-docker.html#build-topology-and-tools">Build topology and tools</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cavs-boot/index.html">Booting up CAVS ADSP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cavs-boot/cavs-dsp-boot-overview.html">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cavs-boot/cavs-dsp-boot-overview.html#ipc-communication-with-dsp-rom">IPC Communication with DSP ROM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cavs-boot/cavs-dsp-boot-overview.html#loading-binaries-to-adsp-memory">Loading Binaries to ADSP Memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cavs-boot/cavs-dsp-boot-overview.html#booting-with-boot-loader">Booting with Boot Loader</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cavs-boot/apollolake/index.html">Apollolake Boot Process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cavs-boot/apollolake/apl-boot-rom.html">Apollolake Boot ROM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cavs-boot/apollolake/apl-boot-ldr.html">Apollolake Boot Loader</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="build-docker.html">Build Sound Open Firmware from a Docker Container</a><ul>
<li class="toctree-l3"><a class="reference internal" href="build-docker.html#setup-docker">Setup Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-docker.html#prepare-docker-image-choose-one">Prepare Docker image (choose one)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="build-docker.html#build-docker-image">1. Build Docker image</a></li>
<li class="toctree-l4"><a class="reference internal" href="build-docker.html#pull-docker-image-from-docker-hub">2. Pull Docker image from Docker hub</a></li>
<li class="toctree-l4"><a class="reference internal" href="build-docker.html#import-docker-image-from-tarball">3. Import Docker image from tarball</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="build-docker.html#use-docker-container-to-build-sof">Use Docker container to build SOF</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Build From Scratch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#currently-supported-targets">Currently Supported Targets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-sof-binaries">Build SOF binaries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#create-the-build-environment">Create the build environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-the-xtensa-cross-compiler-choose-one">Install the xtensa cross compiler (choose one)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-alsa-lib-alsa-utils-alsa-plugins">Install alsa-lib alsa-utils alsa-plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-the-image-builder">Install the image builder</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-sof-firmware-source-code-and-build-an-image">Build SOF firmware source code and build an image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-tools-and-topology-from-sound-open-firmware-tools">Build tools and topology from sound-open-firmware-tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-your-kernel">Build your kernel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#set-up-target-machine">Set up target machine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-the-kernel">Install the kernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-the-rmbox-tools">Install the rmbox tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-user-group">Set up user group</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-and-test-with-sof">Enable and test with SOF</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-vm">Create a VM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#install-the-qemu-vms">Install the Qemu VMs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-new-ubuntu-vm">Create a new Ubuntu VM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-the-qemu-scripts">Update the qemu scripts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#update-the-kernel-on-your-vm">Update the kernel on your VM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-driver-and-firmware-on-vms">Run the driver and firmware on VMs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html">Set up SOF on Minnowboard Turbot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html#minnowboard-resources">Minnowboard resources</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html#about-turbot">About Turbot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html#schematic">Schematic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html#bios">BIOS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html#development">Development</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html#hardware-rework-connect-external-audio-codec">Hardware Rework &amp; Connect External Audio Codec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html#update-bios-and-insert-oem-key">Update BIOS and Insert OEM Key</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html#install-linux">Install Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html#set-up-sof">Set Up SOF</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html#kernel-build">Kernel build</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_minnowboard_turbot.html#contact-for-help">Contact for Help</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../setup/setup_up_2_board.html">Set up SOF on Up Squared board with Hifiberry DAC+ (STD)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../setup/setup_up_2_board.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../setup/setup_up_2_board.html#setup-instructions">Setup Instructions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_up_2_board.html#flash-the-3-6-bios-version-on-the-up-squared-board">1. Flash the 3.6 BIOS version on the Up squared board.</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_up_2_board.html#install-ubilinux-or-ubuntu">2. Install Ubilinux or Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_up_2_board.html#update-kernel">3. Update kernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_up_2_board.html#firmware">4. Firmware</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_up_2_board.html#topology">5. Topology</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_up_2_board.html#add-acpi-support-for-hifiberry-dac">6. Add ACPI support for Hifiberry dac+</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_up_2_board.html#add-sst-drivers-to-blacklist-dsp-conf">7. Add sst drivers to blacklist-dsp.conf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/setup_up_2_board.html#reboot">8. Reboot</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../platforms/index.html">Supported Platforms</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../platforms/intel-cavs/index.html">Intel CAVS Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../platforms/intel-cavs/apollolake/index.html">Intel Apollo Lake</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../platforms/intel-cavs/apollolake/apl-memory.html">APL Memory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../platforms/intel-cavs/cannonlake/index.html">Intel Cannon Lake</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../platforms/intel-cavs/cannonlake/cnl-memory.html">CNL Memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../platforms/intel-cavs/cannonlake/cnl-config.html">CNL Configuration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer_guides/index.html">Developer Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/porting.html">Porting Guides</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/porting.html#architecture-porting-guide">Architecture Porting Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/porting.html#platform-porting-guide">Platform Porting Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/drivers/index.html">Drivers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/drivers/dma/index.html">DMA Drivers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/drivers/dma/index.html#intro">Intro</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/drivers/dma/index.html#programming-flows">Programming Flows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/drivers/dma/index.html#using-dma-driver-api">Using DMA Driver API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/drivers/dma/index.html#supported-devices">Supported Devices</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/drivers/dai/index.html">DAI Drivers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/drivers/dai/index.html#intro">Intro</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/drivers/dai/index.html#programming-flows">Programming Flows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/drivers/dai/index.html#using-dai-driver-api">Using DAI Driver API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/drivers/dai/index.html#supported-devices">Supported Devices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../developer_guides/unit_tests.html">Unit Tests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/unit_tests.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/unit_tests.html#enabling-unit-tests">Enabling unit tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../developer_guides/unit_tests.html#example-running-tests-for-apl">Example: Running tests for APL</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/unit_tests.html#preparing-cmocka-package">Preparing cmocka package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../developer_guides/unit_tests.html#notes">Notes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/index.html">How-Tos</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../howtos/index.html#technical-notes">Technical Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../howtos/tech/placeholder.html">Work in Progress</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../howtos/index.html#process-notes">Process Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../howtos/process/docbuild.html">SOF documentation generation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../howtos/process/docbuild.html#documentation-overview">Documentation overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../howtos/process/docbuild.html#set-up-the-documentation-working-folders">Set up the documentation working folders</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../howtos/process/docbuild.html#installing-the-documentation-tools">Installing the documentation tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../howtos/process/docbuild.html#documentation-presentation-theme">Documentation presentation theme</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../howtos/process/docbuild.html#running-the-documentation-processors">Running the documentation processors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../howtos/process/docbuild.html#publishing-content">Publishing content</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">Contributing to the Project</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/contribute_guidelines.html">Contribution Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/contribute_guidelines.html#licensing">Licensing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/contribute_guidelines.html#developer-certification-of-origin-dco">Developer Certification of Origin (DCO)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../contribute/contribute_guidelines.html#dco-sign-off-methods">DCO Sign-Off Methods</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/contribute_guidelines.html#prerequisites">Prerequisites</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/doc_guidelines.html">Documentation Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#headings">Headings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#content-highlighting">Content Highlighting</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#lists">Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#multi-column-lists">Multi-column lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#file-names-and-commands">File names and Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#internal-cross-reference-linking">Internal Cross-Reference Linking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#non-ascii-characters">Non-ASCII Characters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#code-and-command-examples">Code and Command Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/doc_guidelines.html#tabs-spaces-and-indenting">Tabs, spaces, and indenting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../contribute/dox-source-code.html">Documenting the Source Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/dox-source-code.html#basic-rules">Basic Rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../contribute/dox-source-code.html#examples">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/dma-drivers-api.html">DMA Drivers API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/dai-drivers-api.html">DAI Drivers API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/platform-api.html">Platform API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/uapi.html">uAPI</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SOF Project</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Getting Started Guide</a> &raquo;</li>
        
      <li>Build From Scratch</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="build-from-scratch">
<span id="id1"></span><h1>Build From Scratch<a class="headerlink" href="#build-from-scratch" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#currently-supported-targets" id="id2">Currently Supported Targets</a></li>
<li><a class="reference internal" href="#build-sof-binaries" id="id3">Build SOF binaries</a><ul>
<li><a class="reference internal" href="#create-the-build-environment" id="id4">Create the build environment</a></li>
<li><a class="reference internal" href="#install-the-xtensa-cross-compiler-choose-one" id="id5">Install the xtensa cross compiler (choose one)</a><ul>
<li><a class="reference internal" href="#use-the-xtensa-cross-compiler-binaries" id="id6">1. Use the xtensa cross compiler binaries</a></li>
<li><a class="reference internal" href="#build-toolchain-from-source" id="id7">2. Build Toolchain from source</a></li>
<li><a class="reference internal" href="#use-xt-xcc" id="id8">3. Use xt-xcc</a></li>
</ul>
</li>
<li><a class="reference internal" href="#install-alsa-lib-alsa-utils-alsa-plugins" id="id9">Install alsa-lib alsa-utils alsa-plugins</a></li>
<li><a class="reference internal" href="#install-the-image-builder" id="id10">Install the image builder</a></li>
<li><a class="reference internal" href="#build-sof-firmware-source-code-and-build-an-image" id="id11">Build SOF firmware source code and build an image</a></li>
<li><a class="reference internal" href="#build-tools-and-topology-from-sound-open-firmware-tools" id="id12">Build tools and topology from sound-open-firmware-tools</a></li>
<li><a class="reference internal" href="#build-your-kernel" id="id13">Build your kernel</a></li>
</ul>
</li>
<li><a class="reference internal" href="#set-up-target-machine" id="id14">Set up target machine</a><ul>
<li><a class="reference internal" href="#install-the-kernel" id="id15">Install the kernel</a></li>
<li><a class="reference internal" href="#install-the-rmbox-tools" id="id16">Install the rmbox tools</a></li>
<li><a class="reference internal" href="#set-up-user-group" id="id17">Set up user group</a></li>
<li><a class="reference internal" href="#enable-and-test-with-sof" id="id18">Enable and test with SOF</a></li>
</ul>
</li>
<li><a class="reference internal" href="#create-a-vm" id="id19">Create a VM</a><ul>
<li><a class="reference internal" href="#install-the-qemu-vms" id="id20">Install the Qemu VMs</a></li>
<li><a class="reference internal" href="#create-a-new-ubuntu-vm" id="id21">Create a new Ubuntu VM</a></li>
<li><a class="reference internal" href="#update-the-qemu-scripts" id="id22">Update the qemu scripts</a></li>
<li><a class="reference internal" href="#update-the-kernel-on-your-vm" id="id23">Update the kernel on your VM</a></li>
<li><a class="reference internal" href="#run-the-driver-and-firmware-on-vms" id="id24">Run the driver and firmware on VMs</a></li>
</ul>
</li>
</ul>
</div>
<p>You may enable and test Sound Open Firmware on a Target machine or VM</p>
<div class="section" id="currently-supported-targets">
<span id="supported-targets"></span><h2><a class="toc-backref" href="#id2">Currently Supported Targets</a><a class="headerlink" href="#currently-supported-targets" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>BYT: <a class="reference external" href="/display/LINUXAUDIO/SOF+on+Minnowboard+Turbot">SOF on Minnowboard Turbot</a></li>
<li>HSW:</li>
<li>BDW:</li>
<li>APL: <a class="reference external" href="/display/LINUXAUDIO/SOF+on+GP+MRB">SOF on GP MRB</a></li>
<li>CNL: <a class="reference external" href="/display/LINUXAUDIO/SOF+on+Cannon+Lake">SOF on Cannon Lake</a></li>
</ul>
</div>
<div class="section" id="build-sof-binaries">
<h2><a class="toc-backref" href="#id3">Build SOF binaries</a><a class="headerlink" href="#build-sof-binaries" title="Permalink to this headline">¶</a></h2>
<p>The following steps describe how to install the Sound Open Firmware development
environment on Ubuntu 16.04.</p>
<p>This WIKI example code take ~/work/reef/ as the working dir. We keep
most of the git repos in this folder and think they are siblings.</p>
<div class="section" id="create-the-build-environment">
<h3><a class="toc-backref" href="#id4">Create the build environment</a><a class="headerlink" href="#create-the-build-environment" title="Permalink to this headline">¶</a></h3>
<p>It’s best to put all the SOF code under one common directory structure
to make development easier. We also need to install some dependencies.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ sudo apt-get install libgtk-3-dev libsdl-dev libspice-protocol-dev libspice-server-dev libusb-1.0-0-dev libusbredirhost-dev libtool-bin iasl valgrind texinfo virt-manager kvm libvirt-bin virtinst libfdt-dev libssl-dev pkg-config
$ mkdir sof
$ <span class="nb">cd</span> sof
</pre></div>
</div>
</div>
<div class="section" id="install-the-xtensa-cross-compiler-choose-one">
<h3><a class="toc-backref" href="#id5">Install the xtensa cross compiler (choose one)</a><a class="headerlink" href="#install-the-xtensa-cross-compiler-choose-one" title="Permalink to this headline">¶</a></h3>
<p>Choose one of the following 3 options:</p>
<div class="section" id="use-the-xtensa-cross-compiler-binaries">
<h4><a class="toc-backref" href="#id6">1. Use the xtensa cross compiler binaries</a><a class="headerlink" href="#use-the-xtensa-cross-compiler-binaries" title="Permalink to this headline">¶</a></h4>
<p>The xtensa GCC cross compiler, GDB and binutils are required to build
and debug xtensa binaries on x86 hosts. Each DSP target requires a
different compiler.</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Target</th>
<th class="head">Compiler</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Baytrail, Cherrytrail, Braswell</td>
<td>xtensa-byt-elf.tar.bz2</td>
</tr>
<tr class="row-odd"><td>Haswell Broadwell</td>
<td>xtensa-hsw-elf.tar.bz2</td>
</tr>
<tr class="row-even"><td>Broxton Skylake Kabylake</td>
<td>xtensa-bxt-elf.tar.bz2</td>
</tr>
<tr class="row-odd"><td>Sue creek</td>
<td>xtensa-sue-elf.tar.bz2</td>
</tr>
<tr class="row-even"><td>Canonlake</td>
<td>xtensa-cnl-elf.tar.bz2</td>
</tr>
<tr class="row-odd"><td>Shared headers</td>
<td>xtensa-root.tar.bz2</td>
</tr>
</tbody>
</table>
<p>The pre-compiled cross toolchains can be downloaded from
<a class="reference external" href="http://bee.sh.intel.com/">bee.sh.intel.com</a></p>
<p>You will need an account on bee with audio group access to checkout the
code. please contact with <a class="reference external" href="mailto:ying&#46;huang&#37;&#52;&#48;intel&#46;com">ying<span>&#46;</span>huang<span>&#64;</span>intel<span>&#46;</span>com</a> to get the right.</p>
<p>TODO: Merge access request wiki into one.</p>
<p>Now in SOF folder scp
<a class="reference external" href="mailto:user&#37;&#52;&#48;bee&#46;sh&#46;intel&#46;com:/git/audio/reef/*&#46;bz2">user<span>&#64;</span>bee<span>&#46;</span>sh<span>&#46;</span>intel<span>&#46;</span>com:/git/audio/reef-archive/*<span>&#46;</span>bz2</a>
you will see six tar packages:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">-rw-rw-r-- 1 liam audio 22289290 6月 28 2016 xtensa-bxt-elf.tar.bz2</span>
<span class="go">-rw-rw-r-- 1 liam audio 22328053 6月 28 2016 xtensa-byt-elf.tar.bz2</span>
<span class="go">-rw-r--r-- 1 pxl audio 22353435 5月 18 14:16 xtensa-cnl-elf.tar.bz2</span>
<span class="go">-rw-rw-r-- 1 liam audio 22357873 7月 27 2016 xtensa-hsw-elf.tar.bz2</span>
<span class="go">-rw-rw-r-- 1 liam audio 12777297 5月 18 14:24 xtensa-root.tar.bz2</span>
<span class="go">-rw-rw-r-- 1 liam audio 126476764 3月 7 2017 xtensa-sue-elf.tar.bz2</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tar xvjf xtensa-bxt-elf.tar.bz2
$ tar xvjf xtensa-byt-elf.tar.bz2
$ tar xvjf xtensa-hsw-elf.tar.bz2
$ tar xvjf xtensa-cnl-elf.tar.bz2
$ tar xvjf xtensa-sue-elf.tar.bz2
$ tar xvjf xtensa-root.tar.bz2
</pre></div>
</div>
<p>This will install the xtensa cross compilers locally. Please now add
sof/xtensa-platforms-elf/bin,to your $PATH</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>~/work/sof/xtensa-byt-elf/bin/:<span class="nv">$PATH</span>
$ <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>~/work/sof/xtensa-sue-elf/bin/:<span class="nv">$PATH</span>
$ <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>~/work/sof/xtensa-bxt-elf/bin/:<span class="nv">$PATH</span>
$ <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>~/work/sof/xtensa-hsw-elf/bin/:<span class="nv">$PATH</span>
$ <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>~/work/sof/xtensa-cnl-elf/bin/:<span class="nv">$PATH</span>
</pre></div>
</div>
<p>This will make sure the xtensa compilers can be run from your bash
shell.</p>
</div>
<div class="section" id="build-toolchain-from-source">
<h4><a class="toc-backref" href="#id7">2. Build Toolchain from source</a><a class="headerlink" href="#build-toolchain-from-source" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/work/sof/
$ git clone htts://github.com/01org/osadsp-crosstool-ng.git ct-ng.git
$ <span class="nb">cd</span> ct-ng.git
</pre></div>
</div>
<p>Build crosstool-NG</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ./bootstrap
$ ./configure --prefix<span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
$ make
$ make install
</pre></div>
</div>
<p>Now build the xtensa cross compiler for platforms.</p>
<p>Now we support platform to be byt, hsw, bxy, cnl, sue</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ./ct-ng xtensa-byt-elf
$ ./ct-ng build
</pre></div>
</div>
<p>The cross compiler is now built in builds folder</p>
<p>Now add the Xtensa cross compiler to your PATH.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>~/work/sof/ct-ng.git/builds/xtensa-byt-elf/bin:<span class="nv">$PATH</span>
</pre></div>
</div>
<p>Build the headers</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/work/reef/
$ git clone https://github.com/jcmvbkbc/newlib-xtensa.git
$ <span class="nb">cd</span> newlib-xtensa.git
$ git checkout -b xtensa origin/xtensa
$ ./configure --target<span class="o">=</span>xtensa-byt-elf --prefix<span class="o">=</span>~/work/sofcd ../xtensa-root
$ make
$ make install
</pre></div>
</div>
<p>Above is the example for BYT, you may need to repeat for other
platforms.</p>
</div>
<div class="section" id="use-xt-xcc">
<h4><a class="toc-backref" href="#id8">3. Use xt-xcc</a><a class="headerlink" href="#use-xt-xcc" title="Permalink to this headline">¶</a></h4>
<p>First follow the below instruction to set up the Xtensa Xplorer</p>
<p><a class="reference external" href="/display/LINUXAUDIO/Xtensa+Xplorer+Set+Up+on+Ubuntu">Xtensa Xplorer Set Up on Ubuntu</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Xplorer tools version varies from platform to platform. Please see
the platform pages for more information.</p>
</div>
</div>
</div>
<div class="section" id="install-alsa-lib-alsa-utils-alsa-plugins">
<h3><a class="toc-backref" href="#id9">Install alsa-lib alsa-utils alsa-plugins</a><a class="headerlink" href="#install-alsa-lib-alsa-utils-alsa-plugins" title="Permalink to this headline">¶</a></h3>
<p>This is needed for the topology build and some new features of alsa and
may need to be installed in both the host and target machines.</p>
<p>Download the code from Git using ssh:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone git://git.alsa-project.org/alsa-lib.git
$ git clone git://git.alsa-project.org/alsa-utils.git
$ git clone git://git.alsa-project.org/alsa-plugins.git
</pre></div>
</div>
<p>or http:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone http://git.alsa-project.org/http/alsa-lib.git
$ git clone http://git.alsa-project.org/http/alsa-utils.git
$ git clone http://git.alsa-project.org/http/alsa-plugins.git
</pre></div>
</div>
<p>The release download can be found here: <a class="reference external" href="https://www.alsa-project.org/main/index.php/Download">https://www.alsa-project.org/main/index.php/Download</a></p>
<p>From each folder run this to build and install:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ./gitcompile
$ sudo make install
</pre></div>
</div>
<p>Copy to the x86_64-linux-gnu folder</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ sudo cp /usr/lib/libasound.<span class="se">\*</span> /usr/lib/x86<span class="se">\_</span><span class="m">64</span>-linux-gnu/
$ sudo cp /usr/lib/alsa<span class="se">\_</span>lib/<span class="se">\*</span> /usr/lib/x86<span class="se">\_</span><span class="m">64</span>-linux-gnu/alsa-lib
</pre></div>
</div>
</div>
<div class="section" id="install-the-image-builder">
<h3><a class="toc-backref" href="#id10">Install the image builder</a><a class="headerlink" href="#install-the-image-builder" title="Permalink to this headline">¶</a></h3>
<p>Checkout and install the ELF firmware image builder (called rimage).
rimage converts ELF executables to binary audio DSP images using the
CoE file format.</p>
<p>Enter your sof folder and run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone git://git.alsa-project.org/sound-open-firmware.git sof.git
$ <span class="nb">cd</span> sof.git
$ ./autogen.sh
$ ./configure --enable-rimage
$ make
$ sudo make install
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If building the topology files fails there is need to git clone
the alsa-lib, build it, but omit the last “make install” step to avoid
audio issues on your development computer. For example if alsa-lib was
build under ~/sof-sdk/alsa-lib run the rimage make with command
“LD_LIBRARY_PATH=$HOME/sof-sdk/alsa-lib/src/.libs make”.</p>
</div>
</div>
<div class="section" id="build-sof-firmware-source-code-and-build-an-image">
<h3><a class="toc-backref" href="#id11">Build SOF firmware source code and build an image</a><a class="headerlink" href="#build-sof-firmware-source-code-and-build-an-image" title="Permalink to this headline">¶</a></h3>
<p>Still in sof.git</p>
<p>For BYT:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ./configure --with-arch<span class="o">=</span>xtensa --with-platform<span class="o">=</span>baytrail --with-root-dir<span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/../xtensa-root/xtensa-byt-elf --host<span class="o">=</span>xtensa-byt-elf
</pre></div>
</div>
<p>For BXT:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ./configure --with-arch<span class="o">=</span>xtensa --with-platform<span class="o">=</span>broxton --with-root-dir<span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/../xtensa-root/xtensa-bxt-elf --host<span class="o">=</span>xtensa-bxt-elf
</pre></div>
</div>
<p>For CNL:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ./configure --with-arch<span class="o">=</span>xtensa --with-platform<span class="o">=</span>cannonlake --with-root-dir<span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/../xtensa-root/xtensa-sue-elf --host<span class="o">=</span>xtensa-sue-elf
</pre></div>
</div>
<p>Run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ make
$ make bin
</pre></div>
</div>
<p>The last make bin step converts the ELF binary to CoE binary format
using rimage.</p>
<p>Copy the firmware binary(e.g. sof-byt.ri) to /lib/firmware/intel/ onto your
target machine</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ scp src/arch/xtensa/sof-byt.ri root@targethost:/lib/firmware/intel/
</pre></div>
</div>
<p>or VM (make sure the VM is booted after #10, then run the following command
on reef source):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ scp -P <span class="m">5555</span> src/arch/xtensa/sof-byt.ri root@localhost:/lib/firmware/intel/
</pre></div>
</div>
</div>
<div class="section" id="build-tools-and-topology-from-sound-open-firmware-tools">
<span id="build-tools-and-topology"></span><h3><a class="toc-backref" href="#id12">Build tools and topology from sound-open-firmware-tools</a><a class="headerlink" href="#build-tools-and-topology-from-sound-open-firmware-tools" title="Permalink to this headline">¶</a></h3>
<p>Goto your sof workspace folder.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone git://git.alsa-project.org/sound-open-firmware-tools.git soft.git
$ <span class="nb">cd</span> soft.git
$ ./autogen.sh
$ ./configure
$ make
$ sudo make install
</pre></div>
</div>
<p>The make will create tplg files in topology folder</p>
<p>Copy the firmware binary(e.g. sof-byt.ri) to /lib/firmware/intel/ on your
target machine</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ scp topology/sof-byt-rt5651.tplg root@targethost:/lib/firmware/intel/
</pre></div>
</div>
<p>or VM (make sure the VM is booted after #10, then run the following command on reef source folder):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ scp -P <span class="m">5555</span> topology/sof-byt-rt5651.tplg root@localhost:/lib/firmware/intel/
</pre></div>
</div>
</div>
<div class="section" id="build-your-kernel">
<h3><a class="toc-backref" href="#id13">Build your kernel</a><a class="headerlink" href="#build-your-kernel" title="Permalink to this headline">¶</a></h3>
<p>Use this branch: <a class="reference external" href="https://github.com/plbossart/sound/tree/topic/sof-v4.14">https://github.com/plbossart/sound/tree/topic/sof-v4.14</a></p>
<p>Go to your sof workspace folder</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ git clone https://github.com/plbossart/sound.git
$ <span class="nb">cd</span> sound
</pre></div>
</div>
<p>Recommended branch for the following is topic/sof-v4.14</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ make menuconfig
</pre></div>
</div>
<p>Navigate to <span class="menuselection">Device Drivers ‣ Sound card support ‣ Advanced Linux Sound Architecture ‣ ALSA for SoC audio support</span></p>
<p>Select SOF related options (You may also need to disable SST HDA audio
drivers or to add them into blacklist)</p>
<p><a class="confluence-embedded-image reference internal" href="../../_images/image2018-4-25.png"><img alt="image0" class="confluence-embedded-image" src="../../_images/image2018-4-25.png" style="height: 400px;" /></a></p>
<p>Exit and save the config</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ make deb-pkg -j8
$ <span class="nb">cd</span> ..
</pre></div>
</div>
<p>Copy the deb packages to you target machine</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ scp linux-*_amd64.deb  root@targethost:~/debs/
</pre></div>
</div>
<p>or VM (make sure the VM is booted after #10, then run the following command on reef source folder):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ scp -P <span class="m">5555</span> linux-*_amd64.deb root@localhost:~/debs/
</pre></div>
</div>
</div>
</div>
<div class="section" id="set-up-target-machine">
<h2><a class="toc-backref" href="#id14">Set up target machine</a><a class="headerlink" href="#set-up-target-machine" title="Permalink to this headline">¶</a></h2>
<p>Check that your target is <a class="reference internal" href="#supported-targets"><span class="std std-ref">supported</span></a> before
continuing, otherwise you may need a VM.</p>
<div class="section" id="install-the-kernel">
<h3><a class="toc-backref" href="#id15">Install the kernel</a><a class="headerlink" href="#install-the-kernel" title="Permalink to this headline">¶</a></h3>
<p>Go to ~/debs/ and install the deb packages you copied to the target machine
in the previous step</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ sudo dpkg -i * linux-*_amd64.deb
</pre></div>
</div>
</div>
<div class="section" id="install-the-rmbox-tools">
<h3><a class="toc-backref" href="#id16">Install the rmbox tools</a><a class="headerlink" href="#install-the-rmbox-tools" title="Permalink to this headline">¶</a></h3>
<p>See host <a class="reference internal" href="#build-tools-and-topology"><span class="std std-ref">build</span></a> steps.</p>
</div>
<div class="section" id="set-up-user-group">
<h3><a class="toc-backref" href="#id17">Set up user group</a><a class="headerlink" href="#set-up-user-group" title="Permalink to this headline">¶</a></h3>
<p><em>root</em> user can not run <code class="docutils literal"><span class="pre">pluseaudio</span></code>, so please create another user to
test PCMs. You also need to add this user to the audio group to have
access to PCMs</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ usermod -G audio-a &lt;userid&gt;
</pre></div>
</div>
</div>
<div class="section" id="enable-and-test-with-sof">
<h3><a class="toc-backref" href="#id18">Enable and test with SOF</a><a class="headerlink" href="#enable-and-test-with-sof" title="Permalink to this headline">¶</a></h3>
<p>Reboot the system and run <code class="docutils literal"><span class="pre">aplay</span> <span class="pre">-l</span></code> to verify the presence of the sound
card and other devices.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ aplay -l
**** List of PLAYBACK Hardware Devices ****
card <span class="m">0</span>: sofbytcrrt5651 <span class="o">[</span>sof-bytcr-rt5651<span class="o">]</span>, device <span class="m">0</span>: Passthrough <span class="o">(</span>*<span class="o">)</span> <span class="o">[]</span>
 Subdevices: <span class="m">1</span>/1
 Subdevice <span class="c1">#0: subdevice #0</span>
</pre></div>
</div>
<p>If anything goes wrong, please review and save <code class="docutils literal"><span class="pre">dmesg</span></code> output.</p>
</div>
</div>
<div class="section" id="create-a-vm">
<h2><a class="toc-backref" href="#id19">Create a VM</a><a class="headerlink" href="#create-a-vm" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install-the-qemu-vms">
<h3><a class="toc-backref" href="#id20">Install the Qemu VMs</a><a class="headerlink" href="#install-the-qemu-vms" title="Permalink to this headline">¶</a></h3>
<p>Qemu can be used to debug and perform introspection without running the
firmware on real hardware.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ../sof
$ git clone user@bee.sh.intel.com:/git/audio/reef/qemu-xtensa
$ git checkout embargo
$ ./configure --prefix<span class="o">=</span>. --target-list<span class="o">=</span>xtensa-softmmu,x86_64-softmmu --enable-gtk --enable-sdl --enable-spice --audio-drv-list<span class="o">=</span>alsa --enable-libusb --enable-usb-redir --enable-coroutine-pool --disable-opengl --enable-fdt
$ make
</pre></div>
</div>
<p>Do not <code class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></code> qemu as this will overwrite your distros Qemu
version.</p>
</div>
<div class="section" id="create-a-new-ubuntu-vm">
<h3><a class="toc-backref" href="#id21">Create a new Ubuntu VM</a><a class="headerlink" href="#create-a-new-ubuntu-vm" title="Permalink to this headline">¶</a></h3>
<p>A VM running Linux is required for testing driver and firmware
together. It’s best to install the VM using an iso file (e.g. Ubuntu
15.10). There are plenty of instructions on how to create an Ubuntu VM
online, and it’s best to use Virtual Machine <a class="reference external" href="http://virt-manager.org/">Manager</a> (installed as part
of environment setup in stage</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use a minimum file system size for your VM of 16GB, and set VM RAM
size to 2GB</p>
</div>
<p>After the VM has been created you will need to copy the file system
image file to your local reef directory and own it as your user.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ../sof
$ sudo cp /var/lib/libvirt/images/image-name .
$ sudo chown user.user image-name
</pre></div>
</div>
</div>
<div class="section" id="update-the-qemu-scripts">
<h3><a class="toc-backref" href="#id22">Update the qemu scripts</a><a class="headerlink" href="#update-the-qemu-scripts" title="Permalink to this headline">¶</a></h3>
<p>Update the qemu init scripts to point to your VM
image file and reef image. This wont be required in the future, but
please edit the following files, and make sure they point to your
VM image and reef firmware image files.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> qemu
$ vi xtensa-host.sh
$ vi x86-host.sh
</pre></div>
</div>
</div>
<div class="section" id="update-the-kernel-on-your-vm">
<h3><a class="toc-backref" href="#id23">Update the kernel on your VM</a><a class="headerlink" href="#update-the-kernel-on-your-vm" title="Permalink to this headline">¶</a></h3>
<p>Update the default kernel to use your kernel with
Reef firmware support.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1">#start the VM</span>
$ ./x86-host.sh
<span class="c1"># Copy the kernel to the VM. SSH is running on localhost port 5555 for VM</span>
$ scp -P <span class="m">5555</span> linux.deb user@<span class="se">\ </span><span class="sb">`</span>localhost:/home/user &lt;http://localhost/home/user&gt;<span class="sb">`</span>__
<span class="c1"># Log onto VM and install kernel.deb</span>
$ ssh -p <span class="m">5555</span> user@localhost
<span class="c1"># install the kernel and shutdown VM</span>
</pre></div>
</div>
</div>
<div class="section" id="run-the-driver-and-firmware-on-vms">
<h3><a class="toc-backref" href="#id24">Run the driver and firmware on VMs</a><a class="headerlink" href="#run-the-driver-and-firmware-on-vms" title="Permalink to this headline">¶</a></h3>
<p>It’s important to start the DSP VM first, so it is ready for the
driver running on the other VM.</p>
<p>Open two terminals:</p>
<ol class="arabic">
<li><p class="first">Xtensa VM</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ./xtensa-host.sh byt
</pre></div>
</div>
</li>
<li><p class="first">Host OS (Ubuntu)</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ./x86-host.sh byt
</pre></div>
</div>
</li>
</ol>
<p>You will now see the FW booting and responding to IPC from the kernel
in terminal 1.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, SOF Project.
      Last updated on Aug 16, 2018.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>